KGZ1bmN0aW9uICgpIHsKCSd1c2Ugc3RyaWN0JzsKCgljb25zdCBjYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnd2hlZWwtY2FudmFzJyk7Cgljb25zdCBjdHggPSBjYW52YXMgPyBjYW52YXMuZ2V0Q29udGV4dCgnMmQnKSA6IG51bGw7Cgljb25zdCBidG4gPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc3Bpbi1idG4nKTsKCWNvbnN0IHJlc3VsdEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3Jlc3VsdCcpOwoJY29uc3QgY29uZmV0dGlDYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnY29uZmV0dGktY2FudmFzJyk7Cgljb25zdCBjb25mZXR0aUN0eCA9IGNvbmZldHRpQ2FudmFzID8gY29uZmV0dGlDYW52YXMuZ2V0Q29udGV4dCgnMmQnKSA6IG51bGw7Cgljb25zdCBmdWxsc2NyZWVuQ29uZmV0dGlDYW52YXMgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnZnVsbHNjcmVlbi1jb25mZXR0aScpOwoJY29uc3QgZnVsbHNjcmVlbkNvbmZldHRpQ3R4ID0gZnVsbHNjcmVlbkNvbmZldHRpQ2FudmFzID8gZnVsbHNjcmVlbkNvbmZldHRpQ2FudmFzLmdldENvbnRleHQoJzJkJykgOiBudWxsOwoJY29uc3Qgc291bmRUb2dnbGUgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc291bmQtdG9nZ2xlJyk7Cgljb25zdCBzb3VuZEljb24gPSBzb3VuZFRvZ2dsZSA/IHNvdW5kVG9nZ2xlLnF1ZXJ5U2VsZWN0b3IoJy5zb3VuZC1pY29uJykgOiBudWxsOwoJCgkvLyBRdeG6o24gbMO9IMOibSB0aGFuaAoJbGV0IHNvdW5kRW5hYmxlZCA9IHRydWU7CglsZXQgYXVkaW9Db250ZXh0ID0gbnVsbDsKCWxldCBzcGluU291bmRJbnRlcnZhbCA9IG51bGw7CgkKCS8vIEto4bufaSB04bqhbyBBdWRpb0NvbnRleHQgKGPhuqduIHVzZXIgaW50ZXJhY3Rpb24pCglmdW5jdGlvbiBpbml0QXVkaW8oKSB7CgkJaWYgKCFhdWRpb0NvbnRleHQpIHsKCQkJdHJ5IHsKCQkJCWF1ZGlvQ29udGV4dCA9IG5ldyAod2luZG93LkF1ZGlvQ29udGV4dCB8fCB3aW5kb3cud2Via2l0QXVkaW9Db250ZXh0KSgpOwoJCQkJLy8gUmVzdW1lIG7hur91IGLhu4sgc3VzcGVuZGVkIChkbyBhdXRvcGxheSBwb2xpY3kpCgkJCQlpZiAoYXVkaW9Db250ZXh0LnN0YXRlID09PSAnc3VzcGVuZGVkJykgewoJCQkJCWF1ZGlvQ29udGV4dC5yZXN1bWUoKTsKCQkJCX0KCQkJfSBjYXRjaCAoZSkgewoJCQkJY29uc29sZS5sb2coJ0F1ZGlvQ29udGV4dCBub3Qgc3VwcG9ydGVkOicsIGUpOwoJCQl9CgkJfQoJCXJldHVybiBhdWRpb0NvbnRleHQ7Cgl9CgkKCS8vIEto4bufaSB04bqhbyBBdWRpb0NvbnRleHQga2hpIHVzZXIgY2xpY2sgbOG6p24gxJHhuqd1CglmdW5jdGlvbiBpbml0QXVkaW9PbkludGVyYWN0aW9uKCkgewoJCWlmICghYXVkaW9Db250ZXh0ICYmIHNvdW5kRW5hYmxlZCkgewoJCQlpbml0QXVkaW8oKTsKCQl9Cgl9CgkKCS8vIFThuqFvIMOibSB0aGFuaCBxdWF5ICh0b25lIGdp4bqjbSBk4bqnbikKCWZ1bmN0aW9uIHBsYXlTcGluU291bmQoKSB7CgkJaWYgKCFzb3VuZEVuYWJsZWQgfHwgIWF1ZGlvQ29udGV4dCkgcmV0dXJuOwoJCXRyeSB7CgkJCS8vIFJlc3VtZSBu4bq/dSBi4buLIHN1c3BlbmRlZAoJCQlpZiAoYXVkaW9Db250ZXh0LnN0YXRlID09PSAnc3VzcGVuZGVkJykgewoJCQkJYXVkaW9Db250ZXh0LnJlc3VtZSgpOwoJCQl9CgkJCWNvbnN0IG9zY2lsbGF0b3IgPSBhdWRpb0NvbnRleHQuY3JlYXRlT3NjaWxsYXRvcigpOwoJCQljb25zdCBnYWluTm9kZSA9IGF1ZGlvQ29udGV4dC5jcmVhdGVHYWluKCk7CgkJCQoJCQlvc2NpbGxhdG9yLmNvbm5lY3QoZ2Fpbk5vZGUpOwoJCQlnYWluTm9kZS5jb25uZWN0KGF1ZGlvQ29udGV4dC5kZXN0aW5hdGlvbik7CgkJCQoJCQlvc2NpbGxhdG9yLmZyZXF1ZW5jeS52YWx1ZSA9IDIwMCArIE1hdGgucmFuZG9tKCkgKiAxMDA7CgkJCW9zY2lsbGF0b3IudHlwZSA9ICdzaW5lJzsKCQkJCgkJCWdhaW5Ob2RlLmdhaW4uc2V0VmFsdWVBdFRpbWUoMC4xLCBhdWRpb0NvbnRleHQuY3VycmVudFRpbWUpOwoJCQlnYWluTm9kZS5nYWluLmV4cG9uZW50aWFsUmFtcFRvVmFsdWVBdFRpbWUoMC4wMSwgYXVkaW9Db250ZXh0LmN1cnJlbnRUaW1lICsgMC4xKTsKCQkJCgkJCW9zY2lsbGF0b3Iuc3RhcnQoKTsKCQkJb3NjaWxsYXRvci5zdG9wKGF1ZGlvQ29udGV4dC5jdXJyZW50VGltZSArIDAuMSk7CgkJfSBjYXRjaCAoZSkgewoJCQljb25zb2xlLmxvZygnQXVkaW8gZXJyb3I6JywgZSk7CgkJfQoJfQoJCgkvLyDDgm0gdGhhbmgga2hpIHRyw7puZyAoZmFuZmFyZSkKCWZ1bmN0aW9uIHBsYXlXaW5Tb3VuZCgpIHsKCQlpZiAoIXNvdW5kRW5hYmxlZCB8fCAhYXVkaW9Db250ZXh0KSByZXR1cm47CgkJdHJ5IHsKCQkJLy8gUmVzdW1lIG7hur91IGLhu4sgc3VzcGVuZGVkCgkJCWlmIChhdWRpb0NvbnRleHQuc3RhdGUgPT09ICdzdXNwZW5kZWQnKSB7CgkJCQlhdWRpb0NvbnRleHQucmVzdW1lKCk7CgkJCX0KCQkJLy8gVOG6oW8gY2h14buXaSBu4buRdCBuaOG6oWMgdnVpIHbhursKCQkJY29uc3Qgbm90ZXMgPSBbNTIzLjI1LCA2NTkuMjUsIDc4My45OSwgMTA0Ni41MF07IC8vIEMsIEUsIEcsIEMgKHF1w6NuZyB0w6FtKQoJCQljb25zdCBkdXJhdGlvbiA9IDAuMTU7CgkJCQoJCQlub3Rlcy5mb3JFYWNoKChmcmVxLCBpKSA9PiB7CgkJCQlzZXRUaW1lb3V0KCgpID0+IHsKCQkJCQlpZiAoIWF1ZGlvQ29udGV4dCkgcmV0dXJuOwoJCQkJCWNvbnN0IG9zY2lsbGF0b3IgPSBhdWRpb0NvbnRleHQuY3JlYXRlT3NjaWxsYXRvcigpOwoJCQkJCWNvbnN0IGdhaW5Ob2RlID0gYXVkaW9Db250ZXh0LmNyZWF0ZUdhaW4oKTsKCQkJCQkKCQkJCQlvc2NpbGxhdG9yLmNvbm5lY3QoZ2Fpbk5vZGUpOwoJCQkJCWdhaW5Ob2RlLmNvbm5lY3QoYXVkaW9Db250ZXh0LmRlc3RpbmF0aW9uKTsKCQkJCQkKCQkJCQlvc2NpbGxhdG9yLmZyZXF1ZW5jeS52YWx1ZSA9IGZyZXE7CgkJCQkJb3NjaWxsYXRvci50eXBlID0gJ3NpbmUnOwoJCQkJCQoJCQkJCWdhaW5Ob2RlLmdhaW4uc2V0VmFsdWVBdFRpbWUoMC4yLCBhdWRpb0NvbnRleHQuY3VycmVudFRpbWUpOwoJCQkJCWdhaW5Ob2RlLmdhaW4uZXhwb25lbnRpYWxSYW1wVG9WYWx1ZUF0VGltZSgwLjAxLCBhdWRpb0NvbnRleHQuY3VycmVudFRpbWUgKyBkdXJhdGlvbik7CgkJCQkJCgkJCQkJb3NjaWxsYXRvci5zdGFydCgpOwoJCQkJCW9zY2lsbGF0b3Iuc3RvcChhdWRpb0NvbnRleHQuY3VycmVudFRpbWUgKyBkdXJhdGlvbik7CgkJCQl9LCBpICogMTAwKTsKCQkJfSk7CgkJfSBjYXRjaCAoZSkgewoJCQljb25zb2xlLmxvZygnQXVkaW8gZXJyb3I6JywgZSk7CgkJfQoJfQoJCgkvLyBUb2dnbGUgw6JtIHRoYW5oCglmdW5jdGlvbiB0b2dnbGVTb3VuZCgpIHsKCQlzb3VuZEVuYWJsZWQgPSAhc291bmRFbmFibGVkOwoJCWlmIChzb3VuZFRvZ2dsZSkgewoJCQlpZiAoc291bmRFbmFibGVkKSB7CgkJCQlzb3VuZFRvZ2dsZS5jbGFzc0xpc3QucmVtb3ZlKCdtdXRlZCcpOwoJCQkJaWYgKHNvdW5kSWNvbikgc291bmRJY29uLnRleHRDb250ZW50ID0gJ/CflIonOwoJCQkJLy8gS2jhu59pIHThuqFvIEF1ZGlvQ29udGV4dCBraGkgYuG6rXQgw6JtIHRoYW5oCgkJCQlpbml0QXVkaW8oKTsKCQkJCS8vIFBow6F0IMOibSB0aGFuaCB0ZXN0IG5n4bqvbgoJCQkJaWYgKGF1ZGlvQ29udGV4dCkgewoJCQkJCXNldFRpbWVvdXQoKCkgPT4gcGxheVdpblNvdW5kKCksIDEwMCk7CgkJCQl9CgkJCX0gZWxzZSB7CgkJCQlzb3VuZFRvZ2dsZS5jbGFzc0xpc3QuYWRkKCdtdXRlZCcpOwoJCQkJaWYgKHNvdW5kSWNvbikgc291bmRJY29uLnRleHRDb250ZW50ID0gJ/CflIcnOwoJCQkJLy8gROG7q25nIMOibSB0aGFuaCBxdWF5IG7hur91IMSRYW5nIHBow6F0CgkJCQlpZiAoc3BpblNvdW5kSW50ZXJ2YWwpIHsKCQkJCQljbGVhckludGVydmFsKHNwaW5Tb3VuZEludGVydmFsKTsKCQkJCQlzcGluU291bmRJbnRlcnZhbCA9IG51bGw7CgkJCQl9CgkJCX0KCQkJLy8gTMawdSB2w6BvIGxvY2FsU3RvcmFnZQoJCQlsb2NhbFN0b3JhZ2Uuc2V0SXRlbSgnd2hlZWxTb3VuZEVuYWJsZWQnLCBzb3VuZEVuYWJsZWQpOwoJCX0KCX0KCQoJLy8gS2jDtGkgcGjhu6VjIHRr4bunYSB0cm9uZyBk4bqndSB0aOG7m2kgbG9jYWxTdG9yYWdlCglmdW5jdGlvbiByZXN0b3JlU291bmRTdGF0ZSgpIHsKCQljb25zdCBzYXZlZCA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCd3aGVlbFNvdW5kRW5hYmxlZCcpOwoJCWlmIChzYXZlZCAhPT0gbnVsbCkgewoJCQlzb3VuZEVuYWJsZWQgPSBzYXZlZCA9PT0gJ3RydWUnOwoJCX0KCQlpZiAoc291bmRUb2dnbGUpIHsKCQkJaWYgKCFzb3VuZEVuYWJsZWQpIHsKCQkJCXNvdW5kVG9nZ2xlLmNsYXNzTGlzdC5hZGQoJ211dGVkJyk7CgkJCQlpZiAoc291bmRJY29uKSBzb3VuZEljb24udGV4dENvbnRlbnQgPSAn8J+Uhyc7CgkJCX0KCQl9CgkJLy8gS2jDtG5nIHThu7EgxJHhu5luZy BraOG7n2kgdOG6oW8gQXVkaW9Db250ZXh0IChj4bqnbiB1c2VyIGludGVyYWN0aW9uKQoJfQoJCglpZiAoc291bmRUb2dnbGUpIHsKCQlzb3VuZFRvZ2dsZS5hZGRFdmVudExpc3RlbmVyKCdjbGljaycsIHRvZ2dsZVNvdW5kKTsKCX0KCXJlc3RvcmVTb3VuZFN0YXRlKCk7CgkKCS8vIFjhu60gbMO9IHJlc2l6ZSBjaG8gZnVsbHNjcmVlbiBjb25mZXR0aSBjYW52YXMKCWlmIChmdWxsc2NyZWVuQ29uZmV0dGlDYW52YXMpIHsKCQl3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigncmVzaXplJywgZnVuY3Rpb24oKSB7CgkJCWZ1bGxzY3JlZW5Db25mZXR0aUNhbnZhcy53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoOwoJCQlmdWxsc2NyZWVuQ29uZmV0dGlDYW52YXMuaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0OwoJCX0pOwoJfQoKCWNvbnN0IFNMSUNFUyA9IDExOwoJLy8gTmjDo24gdsOgIHRy4buNbmcgc+G7kTogMTAgdm91Y2hlciArIDEgZ2nhuqNpIMSR4bq3YyBiaeG7h3QgKGtow7RuZyBiYW8gZ2nhu50gdHLDum5nKQoJY29uc3Qgc2xvdHMgPSBbCgkJeyBsYWJlbDogJ1ZvdWNoZXIgMTAwaycsIHdlaWdodDogMTAgfSwKCQl7IGxhYmVsOiAnVm91Y2hlciAyMDBrJywgd2VpZ2h0OiAxMCB9LAoJCXsgbGFiZWw6ICdWb3VjaGVyIDMwMGsnLCB3ZWlnaHQ6IDEwIH0sCgkJeyBsYWJlbDogJ1ZvdWNoZXIgNDAwaycsIHdlaWdodDogMTAgfSwKCQl7IGxhYmVsOiAnVm91Y2hlciA1MDBrJywgd2VpZ2h0OiAxMCB9LAoJCXsgbGFiZWw6ICdWb3VjaGVyIDYwMGsnLCB3ZWlnaHQ6IDEwIH0sCgkJeyBsYWJlbDogJ1ZvdWNoZXIgNzAwaycsIHdlaWdodDogMTAgfSwKCQl7IGxhYmVsOiAnVm91Y2hlciA4MDBrJywgd2VpZ2h0OiAxMCB9LAoJCXsgbGFiZWw6ICdWb3VjaGVyIDkwMGsnLCB3ZWlnaHQ6IDEwIH0sCgkJeyBsYWJlbDogJ1ZvdWNoZXIgMSBUUknhu4ZVJywgd2VpZ2h0OiAxMCB9LAoJCXsgbGFiZWw6ICdHSeG6okkgxJDhurZDIEJJ4buGVCcsIHdlaWdodDogMCB9LCAvLyBLSMOUTkcgQkFPIEdJ4bucIFRSw5pORwoJXTsKCgkvLyBNw6B1IGRhcmsgdG9uZXMgY2hvIDExIGzDoXQKCWNvbnN0IHNsaWNlQ29sb3JzID0gWwoJCScjZWM0ODk5JywgLy8gMCAtIGRhcmsgcGluawoJCScjM2I4MmY2JywgLy8gMSAtIGRhcmsgYmx1ZQoJCScjMTBiOTgxJywgLy8gMiAtIGRhcmsgdGVhbAoJCScjZjU5ZTBiJywgLy8gMyAtIGRhcmsgeWVsbG93CgkJJyM4YjVjZjYnLCAvLyA0IC0gZGFyayBwdXJwbGUKCQknI2Y0M2Y1ZScsIC8vIDUgLSBkYXJrIHJvc2UKCQknIzA2YjZkNCcsIC8vIDYgLSBkYXJrIGN5YW4KCQknI2VhNTgwYycsIC8vIDcgLSBkYXJrIG9yYW5nZQoJCScjNjVhMzBkJywgLy8gOCAtIGRhcmsgbGltZQoJCScjZGMyNjI2JywgLy8gOSAtIGRhcmsgcmVkCgkJJyM2YjcyODAnLCAvLyAxMCAtIGdyYXkgKGdp4bqjaSDEkeG6t2MgYmnhu4d0IC0ga2jDtG5nIHRyw7puZykKCV07CgoJLy8gR8OzYyBoaeG7h24gdOG6oWkgY+G7p2EgYsOhbmggeGUKCWxldCBhbmdsZSA9IDA7CglsZXQgc3Bpbm5pbmcgPSBmYWxzZTsKCglmdW5jdGlvbiBkcmF3V2hlZWwoY3VycmVudEFuZ2xlKSB7CgkJaWYgKCFjdHgpIHJldHVybjsKCQljb25zdCB3ID0gY2FudmFzLndpZHRoLCBoID0gY2FudmFzLmhlaWdodDsKCQljb25zdCBjeCA9IHcgLyAyLCBjeSA9IGggLyAyLCByID0gTWF0aC5taW4oY3gsIGN5KSAtIDEwOwoJCWN0eC5jbGVhclJlY3QoMCwgMCwgdywgaCk7CgoJCS8vIFbhur0gY8OhYyBsw6F0CgkJZm9yIChsZXQgaSA9IDA7IGkgPCBTTElDRVM7IGkrKykgewoJCQljb25zdCBzdGFydCA9IChpICogMiAqIE1hdGguUEkgLyBTTElDRVMpICsgY3VycmVudEFuZ2xlOwoJCQljb25zdCBlbmQgPSAoKGkgKyAxKSAqIDIgKiBNYXRoLlBJIC8gU0xJQ0VTKSArIGN1cnJlbnRBbmdsZTsKCQkJY3R4LmJlZ2luUGF0aCgpOwoJCQljdHgubW92ZVRvKGN4LCBjeSk7CgkJCWN0eC5hcmMoY3gsIGN5LCByLCBzdGFydCwgZW5kKTsKCQkJLy8gTcOgdSB0aGVvIHThu6tuZyDDtAoJCQljdHguZmlsbFN0eWxlID0gc2xpY2VDb2xvcnNbaSAlIHNsaWNlQ29sb3JzLmxlbmd0aF07CgkJCWN0eC5maWxsKCk7CgkJCWN0eC5zdHJva2VTdHlsZSA9ICcjZmZmJzsKCQkJY3R4LmxpbmVXaWR0aCA9IDU7IC8vIEJvcmRlciB0cuG6r25nIMSR4bqtbQoJCQljdHguc3Ryb2tlKCk7CgoJCQkvLyBOaMOjbiBtw6B1IHRy4bqvbmcgxJHhuq1tIC0gxJFp4buBdSBjaOG7iW5oIHbhu4sgdHLDrSB2w6AgZm9udCBzaXplCgkJCWNvbnN0IG1pZCA9IChzdGFydCArIGVuZCkgLyAyOwoJCQljb25zdCB0ZXh0UmFkaXVzID0gciAqIDAuNzA7IC8vIFTEg25nIHJhZGl1cyDEkeG7gyB0ZXh0IHhhIHTDom0gaMahbiwga2jDtG5nIGLhu4sgY2jhuq10CgkJCWNvbnN0IGx4ID0gY3ggKyB0ZXh0UmFkaXVzICogTWF0aC5jb3MobWlkKTsKCQkJY29uc3QgbHkgPSBjeSArIHRleHRSYWRpdXMgKiBNYXRoLnNpbihtaWQpOwoJCQljdHguc2F2ZSgpOwoJCQljdHgudHJhbnNsYXRlKGx4LCBseSk7CgkJCWN0eC5yb3RhdGUobWlkICsgTWF0aC5QSSAvIDIpOwoJCQljdHguZmlsbFN0eWxlID0gJyNmZmYnOyAvLyBNw6B1IHRy4bqvbmcKCQkJY3R4LmZvbnQgPSAnYm9sZCAxNHB4IHN5c3RlbS11aSwgc2Fucy1zZXJpZic7IC8vIEZvbnQgcGjDuSBo4bujcCB24bubaSBjYW52YXMgNTAweDUwMAoJCQljdHgudGV4dEFsaWduID0gJ2NlbnRlcic7CgkJCS8vIFRleHQgc2hhZG93IMSR4buDIGThu4UgxJHhu41jIHRyw6puIG7hu4FuIHThu5FpCgkJCWN0eC5zaGFkb3dDb2xvciA9ICdyZ2JhKDAsIDAsIDAsIDAuOCknOwoJCQljdHguc2hhZG93Qmx1ciA9IDQ7CgkJCWN0eC5zaGFkb3dPZmZzZXRYID0gMjsKCQkJY3R4LnNoYWRvd09mZnNldFkgPSAyOwoJCQljdHguZmlsbFRleHQoc2xvdHNbaV0ubGFiZWwsIDAsIDApOwoJCQljdHguc2hhZG93Qmx1ciA9IDA7CgkJCWN0eC5yZXN0b3JlKCk7CgkJfQoKCQkvLyBW4bq9IG7DunQgUVVBWSDhu58gZ2nhu69hIGLDoW5oIHhlCgkJY29uc3QgY2VudGVyUmFkaXVzID0gciAqIDAuMjU7IC8v IELDoW4ga8OtbmggbsO6dCBnaeG7r2EKCQljdHguc2F2ZSgpOwoJCWN0eC5iZWdpblBhdGgoKTsKCQljdHguYXJjKGN4LCBjeSwgY2VudGVyUmFkaXVzLCAwLCAyICogTWF0aC5QSSk7CgkJY3R4LmZpbGxTdHlsZSA9ICcjMTQ1MzJkJzsgLy8gRGFyayBncmVlbgoJCWN0eC5maWxsKCk7CgkJY3R4LnN0cm9rZVN0eWxlID0gJyNmZmYnOwoJCWN0eC5saW5lV2lkdGggPSA0OwoJCWN0eC5zdHJva2UoKTsKCQkvLyBUZXh0ICJRVUFZIiAtIGZvbnQgcGjDuSBo4bujcCB24bubaSBjYW52YXMgNTAweDUwMAoJCWN0eC5maWxsU3R5bGUgPSAnI2ZmZic7CgkJY3R4LmZvbnQgPSAnYm9sZCAyNHB4IHN5c3RlbS11aSwgc2Fucy1zZXJpZic7CgkJY3R4LnRleHRBbGlnbiA9ICdjZW50ZXInOwoJCQljdHguY29tple==